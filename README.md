# HorariosLabInf

This repository contains the code for a small access control system used in the computer labs. It is split into multiple subprojects:

- **back-end** – Python/Flask services.
- **front-end** – The Expo application (React Native/TypeScript).

## Architecture Overview

The system has **two main components**:

1. **QR Generator** (`generador-qr` project) - Generates dynamic JWT QR codes that change every 60 seconds
2. **Access Control** (this project) - Scans and validates QR codes, manages access records

The main architecture is based on Flask REST APIs that expose the data used by the clients. The Expo application and Kivy client scan the **dynamic QR codes** generated by the `generador-qr` project.

```
[generador-qr]           Dynamic JWT QR (60s refresh)
     |
     v
[front-end (Expo)]        <--->  [back-end]

- `back-end` – Unified API with authentication, schedules, student management, QR validation, and all routes.
- `front-end` – Expo project containing the React Native mobile/web app. See its own `README.md` for development instructions.

## Prerequisites

- **Python 3.11** or newer for the back‑end services and optional Kivy client.
- **Node.js 18** (or the version used by Expo) for the front‑end.
- A MySQL database (or compatible) configured via environment variables.

Each service expects an `.env` file with its configuration. The variables follow the standard names seen in the source (`MYSQL_HOST`, `MYSQL_USER`, `MYSQL_PASSWORD`, `MYSQL_DB`, `JWT_SECRET`, `READER_QR_SECRET`, etc.).

**Important**: `READER_QR_SECRET` must match the same variable in the `generador-qr` project to validate JWT tokens correctly.

## Running the Back‑end API

**Unified API (All Services)**

   ```bash
   cd back-end
   python -m venv venv && source venv/bin/activate  # optional
   pip install -r requirements.txt
   python app.py
   ```

   By default it listens on `https://localhost:5001` using the SSL certificates found in the directory. In production `gunicorn` can be used as shown in the `Dockerfile`.

   The unified API provides all endpoints:
   - `/api/auth/*` - Authentication and user management
   - `/api/estudiantes/*` - Student management
   - `/api/qr/*` - QR code validation for students
   - `/api/lector/*` - **Dynamic QR scanner** (validates JWT tokens from generador-qr)
   - `/api/registros/*` - Access record management
   - `/api/horarios/*` - Schedule management
   - `/api/cumplimiento/*` - Compliance tracking
   - `/api/horas/*` - Hour tracking
   - `/api/estado/*` - Status management
   - `/api/health` - Health check

## Running the Expo Front‑end

```bash
cd front-end/web
npm install
npx expo start
```

Open the QR code displayed in the terminal with the Expo Go mobile application or use a simulator/emulator.
See `front-end/web/README.md` for additional details.

More detailed documentation will live in each subproject's future `README` files. This top‑level guide only gives a quick overview of how the repository is organised and how to start the main components.
